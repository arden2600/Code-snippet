## MySQL数据库时间操作<br>
记录在开发mysql数据库中，与日期时间相关的操作代码块整合。日期与时间在数据库中还是两个不同的概念的。<br>

### 日期时间的获取
* 获取当前**日期+时间(date + time)**函数<br>
  在mysql数据库中，日期date是指具体到年月日，时间time则是具体到时分秒。<br>

  **(1) now()函数：**<br>
  而now()函数就是将当前数据库所在系统的日期时间,得到的就是代表当前日期时间对应的字符串。另外，在mysql中还有其他与now函数等价的函数方法：`current_timestamp()`,`localtime()`,`localtimestamp()`<br>
```shell
mysql> select now();
+---------------------+
| now()               |
+---------------------+
| 2017-05-10 14:47:52 |
+---------------------+
1 row in set (0.00 sec)
```
  **(2) sysdate()函数：**<br>
  sysdate()函数与now()类似，不同之处在于：now()函数或者其等价函数的时间计算都是基于语句的开始执行时间，而sysdate()函数是返回系统的时刻时间。可以看看下面的列子:<br>
```shell
mysql> select now(),sleep(2),now();
+---------------------+----------+---------------------+
| now()               | sleep(2) | now()               |
+---------------------+----------+---------------------+
| 2017-05-10 14:57:37 |        0 | 2017-05-10 14:57:37 |
+---------------------+----------+---------------------+
1 row in set (2.03 sec)

mysql> select sysdate(),sleep(2),sysdate();
+---------------------+----------+---------------------+
| sysdate()           | sleep(2) | sysdate()           |
+---------------------+----------+---------------------+
| 2017-05-10 14:57:57 |        0 | 2017-05-10 14:57:59 |
+---------------------+----------+---------------------+
1 row in set (2.00 sec)
```
* 获得当前**日期(date)**函数<br>
  在mysql数据库中，要获取日期，具体到年月日的时间字符串，可以使用如下等价函数:`curdate()`,`current_date()`,`current_date`。<br>
```shell
mysql> select curdate(),current_date(),current_date;
+------------+----------------+--------------+
| curdate()  | current_date() | current_date |
+------------+----------------+--------------+
| 2017-05-10 | 2017-05-10     | 2017-05-10   |
+------------+----------------+--------------+
1 row in set (0.00 sec)
```
* 获得当前**时间(time)**函数<br>
  在mysql中获取时间time函数，返回时分秒对应的字符串。可使用函数包括:`curtime()`,`current_time()`,`current_time`。<br>
```shell
mysql> select curtime(),current_time(),current_time;
+-----------+----------------+--------------+
| curtime() | current_time() | current_time |
+-----------+----------------+--------------+
| 15:09:54  | 15:09:54       | 15:09:54     |
+-----------+----------------+--------------+
1 row in set (0.00 sec)
```
* 日期提取函数：可以提取不同时间段信息<br>
  例如，当在程序中要进行统计或者其他报表相关内容的计算，需要分别提取年份，月份，日，秒，分钟，小时等等。对应的函数就如date,time,year,month,**quarter**,day,hour,minute等等。<br>
```shell
mysql> select date(now()),time(now()),year(now()),month(now()),quarter(now());
+-------------+-------------+-------------+--------------+----------------+
| date(now()) | time(now()) | year(now()) | month(now()) | quarter(now()) |
+-------------+-------------+-------------+--------------+----------------+
| 2017-05-10  | 15:17:26    |        2017 |            5 |              2 |
+-------------+-------------+-------------+--------------+----------------+
1 row in set (0.00 sec)

mysql> select week(now()),day(now()),hour(now()),minute(now()),microsecond(now()
);
+-------------+------------+-------------+---------------+--------------------+
| week(now()) | day(now()) | hour(now()) | minute(now()) | microsecond(now()) |
+-------------+------------+-------------+---------------+--------------------+
|          19 |         10 |          15 |            19 |                  0 |
+-------------+------------+-------------+---------------+--------------------+
1 row in set (0.01 sec)
```
  类似功能，可以使用**extract**函数功能进行提取，提取使用的关键字也是与上面的函数功能方法相同。格式：`select extract(** from **(日期时间))`eg:<br>
```shell
mysql> select extract(quarter from now()),extract(year from now());
+-----------------------------+--------------------------+
| extract(quarter from now()) | extract(year from now()) |
+-----------------------------+--------------------------+
|                           2 |                     2017 |
+-----------------------------+--------------------------+
```
* dayofX：函数获取第几天<br>
 想要获取某一周，一个月，一年中的第几天位置，可以使用dayof函数：dayofyear,dayofmonth,dayofweek...<br>
```shell
mysql> select dayofyear(now()),dayofmonth(now()),dayofweek(now());
+------------------+-------------------+------------------+
| dayofyear(now()) | dayofmonth(now()) | dayofweek(now()) |
+------------------+-------------------+------------------+
|              130 |                10 |                4 |
+------------------+-------------------+------------------+
1 row in set (0.00 sec)
```
* 返回星期和月份名称函数:<br>
 想要获取每个月份或者每个星期第几天中的英文名字，可以使用dayname,monthname等函数。<br>
```shell
mysql> select dayname(now()),dayofmonth(now());
+----------------+-------------------+
| dayname(now()) | dayofmonth(now()) |
+----------------+-------------------+
| Wednesday      |                10 |
+----------------+-------------------+
1 row in set (0.00 sec)
```
* 返回月份中的最后一天<br>
 使用last_day函数来获取月份中的最后一天字符串。<br>
```shell
mysql> select last_day(now());
+-----------------+
| last_day(now()) |
+-----------------+
| 2017-05-31      |
+-----------------+
1 row in set (0.00 sec)
```

### 日期时间的算术操作<br>
在操作过程中，有时候会对日期时间进行操作，例如增加时间间隔，计算时间间隔，时间与字符串的转换等等。<br>

* 日期增加时间间隔处理<br>
  这里的函数间隔操作多数都是在mysql数据库类型为varchar表示的日期基础上的。我们在数据库设计对于日期时间等字段的设置时，尽可能的使用varchar来表示。<br>
  向后增加一天: date_add(now(), interval 1 day)。<br>
  多加一个小时：date_add(now(), interval 1 hour)。<br>
  多加一分钟，一秒钟，一个月，一个季度，一年：date_add(now(), interval 1 minute/second/month/quarter/year)等等。<br>
```shell
mysql> select vc_create_time from t_article_qrcode_record where vc_article_id='1';
+---------------------+
| vc_create_time      |
+---------------------+
| 2017-05-09 15:51:00 |
+---------------------+
1 row in set (0.00 sec)

mysql> select date_add(vc_create_time,interval 1 day) from t_article_qrcode_record 
where vc_article_id='1';
+-----------------------------------------+
| date_add(vc_create_time,interval 1 day) |
+-----------------------------------------+
| 2017-05-10 15:51:00                     |
+-----------------------------------------+
1 row in set (0.09 sec)
```
其他日期时间类型的间隔增加同上，另外，若是要将时间向前推，那么可以使用**date_sub**函数，用法与date_add相同。<br>
* 对月的操作：增加或者减去N月<br>
 有时候在统计操作，会对月份进行操作，若是在mysql中，需要对月份进行相加减可以使用`period_add`。而求月份的差值这可以使用`period_diff`函数。<br>
```shell
mysql> select period_diff('201708',3);
+-------------------------+
| period_diff('201708',3) |
+-------------------------+
|                     209 |
+-------------------------+
1 row in set (0.00 sec)

mysql> select period_add('201708',-3);
+-------------------------+
| period_add('201708',-3) |
+-------------------------+
|                  201705 |
+-------------------------+
1 row in set (0.01 sec)
```
求两个date时间的月份差值，使用**period_diff函数**：<br>
```shell
mysql> SELECT PERIOD_DIFF( date_format("2013-9-1 12:12:12", '%Y%m'), date_format("2014-2-1",'%Y%m'));
+-------------------------------------------------------------------------------
-----------------+
| PERIOD_DIFF(date_format("2013-9-1 12:12:12", '%Y%m'), date_format("2014-2-
1" ,'%Y%m')) |
+-------------------------------------------------------------------------------
-----------------+
|
              -5 |
+-------------------------------------------------------------------------------
-----------------+
1 row in set (0.01 sec)

```
* 计算两个日期相距天数/两个时间的差值<br>
  有时候要计算两个日期相差的具体天数，以用来处理实际的业务，则在mysql中可以使用`datediff(d1,d2)`(d1>d2)函数。若是要计算两个时间的差值，那么可以使用timediff()函数。<br>
```shell
mysql> select datediff('2017-09-01', '2017-8-08');
+-------------------------------------+
| datediff('2017-09-01', '2017-8-08') |
+-------------------------------------+
|                                  24 |
+-------------------------------------+
1 row in set (0.00 sec)

mysql> select timediff('15:30:05','15:20:00');
+---------------------------------+
| timediff('15:30:05','15:20:00') |
+---------------------------------+
| 00:10:05                        |
+---------------------------------+
1 row in set (0.00 sec)

```

### 字符串与日期时间的转化<br>
由于在不少的情景下，设置数据库的时候，对于存储时间，日期的类型，我们通常都是使用varchar类型。也就是字符串类型，但是有时候我们要在数据库中处理日期时间时候，就需要将字符串转换成mysql数据库中date表示日期时间的类型。同理，若是在mysql中已date日期类型存储字段，当我们在程序中传入表示时间的字符串的时候，需要在数据库中将字符串转换为date日期类型，在数据库中进行处理。<br>

